{% extends "core/base.html" %}
{% block heading %}All Users{% endblock %}
{% block script %}
<script type="text/javascript">
function toggleDiv(divId) {
   $("#"+divId).toggle();
}
</script>
{% endblock %}

{% block content %}
{% load extras %}
<p>
Actually logged in as <a href="{% url 'core.views.profile' user.username %}">user</a><br>
Pretending to be logged in as <a href="{% url 'core.views.profile' lyfeuser.username %}">{{ lyfeuser.username}}</a></li>
    {% if friend_requests %}
        <h3>FRIEND REQUESTS</h3>
        
        {% for request in friend_requests %}
        {{ request.requester_id }}<br>
        <a href="{% url 'core.views.addfriend' request.requester_id %}">Add Friend</a> | Deny
        {% endfor %}
    {% endif %}
    
    <h3>PROFILE INFO</h3>
    <ul>
    <li>Points: {{ lyfeuser.cur_points }} / {{ lyfeuser.total_points }}</li>
    <li>Last active date? {{ lyfeuser.last_active_date }}</li>
    <li>Last Friend Points Given: {{ lyfeuser.last_fp_given }}</li>
    <li>Avatar: <br>
    <img src="{{ lyfeuser.avatar.url }}" /></li>
    </ul>
    
    <h3>GOALS</h3>
    <ul>
    {% for goalgroup, groupgoals in goals.items %}
        <li>{{ goalgroup }}
        <ul>
            {% for goal in groupgoals %}
                <li><span class="{{goal.get_status_display}}"><b>{{ goal }}</b></span> ({{goal.get_status_display}})
                
                {% if goal.status == 0 %}
                    <a href="javascript:toggleDiv('update_{{goalgroup.pk}}');">+ Submit Progress Update</a>
                    <div style="display: none;" id = "update_{{goalgroup.pk}}">
                        <form method="post" action="{% url 'core.views.post_update' goalgroup.pk %}">
                        {% csrf_token %}
                        <p>
                        {{ updateform }}
                        </p>
                        <input type="submit" value="Submit Update"/>
                        </form>
                    </div>
                {% endif %}
                
                <br>
                Base Points: {{ goal.base_points }} | Friend Points: {{ goal.friend_points }} | Time Points: {{ goal.time_points }}<br>
                Start Date: {{ goal.start_date }} | Completion Date: {{ goal.completion_date }}
                <p>+Add new action item (TODO: link with goalgroup id) </p>
            {% endfor %}
        </ul>
        <p>+Add new goal (TODO: link to goal add popup)</p>
    {% endfor %}
    </ul>
    
    <h3>NEWSFEED</h3>
    <h5>FRIENDS</h5>
    {% if friends %}
        {% for friend in friends %}
            <a href = "{% url 'core.views.profile' friend.recipient_id %}"><img src = "{{friend.recipient_id|user_avatar_url}}"></a>
        {% endfor %}
        {% else %}
        No friends :(
    {% endif %}
    <br><br>
    <!-- Kind of pointless
    {% if following %}
    <h5>FOLLOWING</h5>
        {% for follow in following %}
            <a href = "{% url 'core.views.profile' follow.recipient_id %}"><img src = "{{follow.recipient_id|user_avatar_url}}"></a>
        {% endfor %}
    {% endif %}
    -->
    <ul>
        {% for update in newsfeed %}
            <li> Update to {{ update.goal_id }} | {{ update.timestamp }}<br>
            {{ update.content }}
            <br>
        {% endfor %}
    </ul>
    <br>
    
</p>
{% endblock %}
